#!/bin/bash
# Pre-commit hook - STRICT mode (blocks commit on any lint errors/warnings)
# Timeout: 20 seconds max

set -e

echo "[HOOK] Pre-commit start: $(date '+%F %T %z')"

# Check if we should run this hook
# Only run for src/** or styles/** changes
if ! git diff --cached --name-only | grep -E '^(src/|styles/)' > /dev/null; then
    echo "[HOOK] No src/ or styles/ changes detected, skipping pre-commit"
    exit 0
fi

echo "[HOOK] Source files changed, running STRICT lint check..."

# Run lint with timeout (STRICT mode - blocks on any errors/warnings)
if timeout 20s npm run lint -- --max-warnings=0 --format=compact 2>&1; then
    echo "[HOOK] ‚úÖ Lint check PASSED - no errors or warnings"
    echo "[HOOK] Pre-commit end: $(date '+%F %T %z')"
    echo "[HOOK] ‚úÖ Commit proceeding (STRICT mode)"
    exit 0
else
    echo "[HOOK] ‚ùå Lint check FAILED - errors or warnings detected"
    echo "[HOOK] üí° Fix lint issues before committing:"
    echo "[HOOK]    npm run lint"
    echo "[HOOK] Pre-commit end: $(date '+%F %T %z')"
    echo "[HOOK] ‚ùå Commit BLOCKED (STRICT mode)"
    exit 1
fi
