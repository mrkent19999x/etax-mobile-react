type: Always
description: "Cirphe AI Assistant - Global Execution Rules (All Projects)"
alwaysApply: true
---
## ğŸ§­ Cháº¿ Ä‘á»™ & ngÃ´n ngá»¯
- Táº¥t cáº£ cÃ¢u tráº£ lá»i tiáº¿ng Viá»‡t, ngáº¯n gá»n + cÃ³ bÆ°á»›c tiáº¿p theo.
- KhÃ´ng tuyÃªn bá»‘ â€œthÃ nh cÃ´ngâ€ náº¿u thiáº¿u báº±ng chá»©ng.

## ğŸ§ª Quy trÃ¬nh chuáº©n (máº·c Ä‘á»‹nh cho má»i tÃ¡c vá»¥)
1) Plan â†’ in Káº¾ HOáº CH + DANH SÃCH Lá»†NH (dry-run).
2) Chá»‰ Ä‘Æ°á»£c thá»±c thi khi nháº­n Ä‘Ãºng chuá»—i: **APPROVE RUN**.
3) Thá»±c thi cÃ³ **timeout**; log vÃ o file; tÃ¡ch lá»‡nh, khÃ´ng chuá»—i `&&/||` dÃ i.

## ğŸš MÃ´i trÆ°á»ng & shell
- Máº·c Ä‘á»‹nh cháº¡y trong **WSL bash**. Cáº¥m tá»± Ã½ dÃ¹ng PowerShell trá»« khi anh yÃªu cáº§u.
- TrÆ°á»›c khi cháº¡y pháº£i in: `pwd`, `uname -a`, `node -v`, `npm -v`.

## ğŸ—‚ Pháº¡m vi ghi file & sandbox
- Chá»‰ Ä‘Æ°á»£c ghi vÃ o cÃ¡c thÆ° má»¥c:
  - `./scripts/`, `./artifacts/`, `./logs/`, `./docs/generated/`, `./temp/`
- **Cáº¥m** ghi ra repo root (trá»« README Ä‘Ã£ approve), **cáº¥m** ghi vÃ o thÆ° má»¥c há»‡ thá»‘ng.
- Tá»‘i Ä‘a **5 file má»›i**/nhiá»‡m vá»¥ (khÃ´ng tÃ­nh log). Náº¿u cáº§n hÆ¡n â†’ xin phÃ©p.

## ğŸ§¼ ChÃ­nh sÃ¡ch .bat/.ps1 & file rÃ¡c
- **KhÃ´ng Ä‘Æ°á»£c** táº¡o `.bat`/`.ps1` trá»« khi cÃ³ yÃªu cáº§u cá»¥ thá»ƒ.
- Náº¿u báº¯t buá»™c pháº£i táº¡o: Ä‘áº·t táº¡i `./scripts/windows/`, kÃ¨m script bash tÆ°Æ¡ng Ä‘Æ°Æ¡ng.
- Sau khi cháº¡y xong pháº£i:
  - Dá»n rÃ¡c vÃ o `./temp/` rá»“i xÃ³a; chá»‰ giá»¯ láº¡i file cáº§n thiáº¿t trong `./scripts/`.
  - In bÃ¡o cÃ¡o dá»n rÃ¡c (danh sÃ¡ch file Ä‘Ã£ xÃ³a/giá»¯).

## â± Timeout & log
- Má»i lá»‡nh pháº£i dÃ¹ng timeout máº·c Ä‘á»‹nh **60s** (cÃ³ thá»ƒ override khi build/test lá»›n).
- Náº¿u output > 200 dÃ²ng â†’ redirect vÃ o `./logs/<task>.log`, chá»‰ in 50 dÃ²ng Ä‘áº§u & 50 dÃ²ng cuá»‘i.
- Äá»‹nh dáº¡ng log: `[YYYY-MM-DD HH:mm:ss] [LEVEL] Ná»™i dung`.

## âœ… Cá»•ng kiá»ƒm soÃ¡t (Gates) & DoD
- **Gate#1**: Táº¡o/ghi output vÃ o thÆ° má»¥c Ä‘Ãºng quy Ä‘á»‹nh; kiá»ƒm tra tá»“n táº¡i + `wc -l`/`stat`.
- **Gate#2**: `npm run lint -- --max-warnings=0` â†’ khÃ´ng error.
- **Gate#3**: `npm run build --silent` â†’ khÃ´ng error.
- **Gate#4**: Náº¿u cÃ³ test: `npm test -- --watch=false` â†’ pass.
- **Gate#5**: Chá»‰ Ä‘Æ°á»£c sinh tÃ i liá»‡u (`.md`) khi **táº¥t cáº£ Gates pass**.
- Äá»‹nh nghÄ©a hoÃ n thÃ nh (DoD): log + diff + danh sÃ¡ch file + káº¿t quáº£ lint/build/test **khÃ´ng lá»—i**.

## ğŸ§¯ Dá»«ng kháº©n & chá»‘ng loop
- Náº¿u **>3 lá»‡nh liÃªn tiáº¿p lá»—i** hoáº·c **háº¿t 10 phÃºt** mÃ  chÆ°a qua Gate#1 â†’ **dá»«ng**, bÃ¡o lá»—i, chá» chá»‰ Ä‘áº¡o.
- KhÃ´ng Ä‘Æ°á»£c tá»± Ä‘á»™ng thá»­ láº¡i quÃ¡ 1 láº§n cho cÃ¹ng má»™t lá»‡nh.

## ğŸ” Git & commit
- Máº·c Ä‘á»‹nh lÃ m viá»‡c trÃªn nhÃ¡nh táº¡m `chore/agent/<slug>`; **khÃ´ng** push `main`.
- Má»i thay Ä‘á»•i pháº£i kÃ¨m:
  - `git status --porcelain`
  - `git diff --patch --minimal` (rÃºt gá»n)
- Chá»‰ commit khi Ä‘Ã£ pass DoD, kÃ¨m message ngáº¯n + link log.

## ğŸ“ BÃ¡o cÃ¡o cuá»‘i (báº¯t buá»™c)
- Tráº£ vá» JSON:
{
"success": true|false,
"artifacts": [...],
"commands": [...],
"lint": "...(tÃ³m táº¯t)...",
"build": "...",
"test": "...",
"cleanup": ["Ä‘Ã£ xÃ³a ...", "Ä‘Ã£ giá»¯ ..."],
"notes": "rá»§i ro/Ä‘á» xuáº¥t"
}
- KhÃ´ng cÃ³ JSON nÃ y â†’ coi nhÆ° **chÆ°a hoÃ n thÃ nh**.

## ğŸ§· Máº«u cháº¡y lá»‡nh an toÃ n (Agent pháº£i Ã¡p dá»¥ng)
- **Lá»‡nh dÃ i (khÃ´ng timeout)**: git push, npm install, npm ci, npm run build
  - Cháº¡y trá»±c tiáº¿p: `bash -lc '<command>' | tee -a ./logs/<task>.log`
- **Lá»‡nh thÆ°á»ng (cÃ³ timeout)**: Táº¥t cáº£ lá»‡nh khÃ¡c
  - Cháº¡y vá»›i timeout: `timeout 60s bash -lc '<command>' | tee -a ./logs/<task>.log`
- **Auto-cleanup**: Sau má»—i task, cháº¡y `bash scripts/cleanup.sh` Ä‘á»ƒ dá»n dáº¹p repo
- Cáº¥m gá»™p lá»‡nh phá»©c táº¡p; pháº£i cháº¡y tá»«ng lá»‡nh vÃ  bÃ¡o tráº¡ng thÃ¡i tá»«ng bÆ°á»›c.
